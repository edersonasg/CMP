<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
</head>

<body class="pin">
    <div class="container-fluid head" id="head">
        <div class="row">
            <div class="col-2 logo">
                <a href="/"><img src="/img/logo.jpg" width="75px" alt=""></a>
                <p><br>Duckintosh</br>
                <h4 class="sis">Systems</h4>
                </p>
            </div>
            <div class="col-10">
                <ul class="menu">
                    <li><a href="#sistemas">Nossos Sistemas</a></li>
                    <li><a href="#recursos">Recursos Utilizados</a></li>
                    <li><a href="#quemsomos">Quem Somos</a></li>
                    <li><a href="#contato">Contato</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container-fluid prin">
        <div class="row">
            <div class="col-2 btnCadastro">
                <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal"
                    data-bs-whatever="@mdo" onclick="abrirModal();">CADASTRAR CMP</button>
            </div>
            <div class="col-3">
                <input id="datepicker" type="text" onchange="data();carregarCMP();" />
            </div>
        </div>
        <div class="row">
            <table class="table table-hover table-dark">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nº CMP</th>
                        <th scope="col">CLIENTE</th>
                        <th scope="col">DATA EMISSÃO</th>
                        <th scope="col">DATA BP</th>
                        <th scope="col">RESPONSAVEL</th>
                        <th scope="col">MOTIVO</th>
                        <th scope="col">OBS</th>
                    </tr>
                </thead>
                <tbody id="tabela">

                </tbody>
            </table>
        </div>
        <div class="col-12 text-center">
            <button type="button" class="btn btn-success m-1" data-bs-toggle="modal"
                data-bs-target="#statusSuccessModal">Success Modal</button>
        </div>

    </div>
    <!--
<div class="container-fluid">
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">New message</h1>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="col-6">
                                <label for="ncmp" class="col-form-label">Nº CMP:</label>
                                <input type="text" class="form-control" id="ncmp">
                            </div>
                            <div class="col-6">
                                <label for="message-text" class="col-form-label">Message:</label>
                                <textarea class="form-control" id="message-text"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Send message</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    -->
    <div class="container-fluid cadastro" id="cadastro">
        <form class="cadcmp">
            <div class="row">
                <button type="button" class="btn btn-close btn-secondary" onclick="fecharModal();">Fechar</button>
            </div>
            <div class="row">
                <div class="col-12">
                    <p>CADASTRO CMP</p>
                </div>
                <div class="col-3">
                    <label for="ncmp" class="col-form-label">Nº CMP:</label>
                    <input type="text" class="form-control" id="ncmp">
                </div>
                <div class="col-3">
                    <label for="message-text" class="col-form-label">Cliente:</label>
                    <input class="form-control" id="cliente"></input>
                </div>
                <div class="col-3">
                    <label for="message-text" class="col-form-label">Data Emissão:</label>
                    <input type="date" class="form-control" id="data_emissao"></input>
                </div>
                <div class="col-3">
                    <label for="message-text" class="col-form-label">Data BP:</label>
                    <input type="date" class="form-control" id="data_bp"></input>
                </div>
                <div class="col-4">
                    <label for="ncmp" class="col-form-label">Resposável:</label>
                    <select id="responsavel" name="select">
                        <option value="FLAVIA">FLAVIA</option>
                        <option value="HELENA" selected>HELENA</option>
                        <option value="KELLEN">KELLEN</option>
                    </select>
                </div>
                <div class="col-4">
                    <label for="ncmp" class="col-form-label">Motivo:</label>
                    <select id="motivo" name="select">
                        <option value="MODIFICAÇÃO">MODIFICAÇÃO</option>
                        <option value="CRIAÇÃO" selected>CRIAÇÃO</option>
                        <option value="COMUNIZAÇÃO">COMUNIZAÇÃO</option>
                    </select>
                </div>
                <div class="col-4">
                    <label for="ncmp" class="col-form-label">OBS:</label>
                    <input type="text" class="form-control" id="obs">
                </div>
                <div class="row btnsalvar">
                    <div class="col-12">
                        <button type="button" class="btn btn-primary" onclick="salvar();">Salvar</button>
                    </div>
                </div>
            </div>
        </form>
        <div class="modal fade" id="statusSuccessModal" tabindex="-1" role="dialog" data-bs-backdrop="static"
            data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
                <div class="modal-content">
                    <div class="modal-body text-center p-lg-4">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 130.2 130.2">
                            <circle class="path circle" fill="none" stroke="#198754" stroke-width="6"
                                stroke-miterlimit="10" cx="65.1" cy="65.1" r="62.1" />
                            <polyline class="path check" fill="none" stroke="#198754" stroke-width="6"
                                stroke-linecap="round" stroke-miterlimit="10"
                                points="100.2,40.2 51.5,88.8 29.8,67.5 " />
                        </svg>
                        <h4 class="text-success mt-3">Oh Yeah!</h4>
                        <p class="mt-3">You have successfully registered and logged in.</p>
                        <button type="button" class="btn btn-sm mt-3 btn-success" data-bs-dismiss="modal">Ok</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>

    $(function () {

        const myDate = new Date().toLocaleDateString();
        console.log(myDate); // 29/07/2022 
        const myInput = document.querySelector("#datepicker");
        myInput.value = myDate;
        $("#datepicker").datepicker({
            showOn: "button",
            buttonImage: "/img/calendario.png",
            dateFormat: 'dd/mm/yy',
            dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],
            dayNamesMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S', 'D'],
            dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
            monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
            monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
            nextText: 'Proximo',
            prevText: 'Anterior'
        });
    });

    function data() {
        const dat = document.getElementById("datepicker").value;
    }

    carregarCMP()
    async function carregarCMP() {
        try {
            const myDate = new Date().toLocaleDateString();
            const data = document.getElementById("datepicker").value || myDate;
            const resposta = await fetch('./apiConsultaCMP?data=' + data);
            const body = await resposta.json();

            let tabela = '';
            for (i = 0; i <= body.length - 1; i++) {
                tabela += '<tr>'
                tabela += '<th scope="row"><input type="checkbox" name="nome1" id="nome1"></th>'
                tabela += '<td>' + body[i].CMP + '</td>'
                tabela += '<td>' + body[i].CLIENTE + '</td>'
                tabela += '<td>' + body[i].DATA_EMISSAO + '</td>'
                tabela += '<td>' + body[i].DATA_BP + '</td>'
                tabela += '<td>' + body[i].RESPONSAVEL + '</td>'
                tabela += '<td>' + body[i].MOTIVO + '</td>'
                tabela += '<td>' + body[i].OBS + '</td>'
                tabela += '</tr>'
            }
            document.getElementById("tabela").innerHTML = tabela;
        } catch (error) {
            console.log(error);
        }
    }

    function fecharModal() {
        const elemento = document.querySelector('#cadastro');
        elemento.classList.remove('abrir');
        elemento.classList.add('fechar');
    }

    function abrirModal() {
        const elemento = document.querySelector('#cadastro');
        elemento.classList.remove('fechar');
        elemento.classList.add('abrir');
        $(".alert").show('medium');
        setTimeout(function () {
            $(".alert").hide('medium');
        }, 5000);
    }

    async function salvar() {
        const cmp = document.getElementById("ncmp").value;
        const cliente = document.getElementById("cliente").value;
        const data_emissao = document.getElementById("data_emissao").value;
        const data_bp = document.getElementById("data_bp").value;
        const responsavel = document.getElementById("responsavel").value;
        const motivo = document.getElementById("motivo").value;
        const obs = document.getElementById("obs").value;

        const data = {
            CMP: cmp,
            CLIENTE: cliente,
            DATA_EMISSAO: data_emissao,
            DATA_BP: data_bp,
            RESPONSAVEL: responsavel,
            MOTIVO: motivo,
            OBS: obs,
        }

        try {
            fetch('./apiCriarCmp', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            })
                .then((response) => response.json())
            //.then(response => console.log(response.status))

            $('#statusSuccessModal').modal('toggle')

            fecharModal();
            location.reload();

        } catch (error) {
            console.log(error);
        }
    }
</script>

</html>